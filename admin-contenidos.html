<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Administración de Contenidos - INACAP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card { border-radius: 1rem; }
        .builder-pill { border-radius: 999px; }
    </style>
</head>
<body class="bg-light">
    <div class="d-flex vh-100">
        <div id="sidebar"></div>
        <div class="flex-grow-1 d-flex flex-column">
            <div id="header"></div>
            <main class="flex-grow-1 p-4 p-lg-5 overflow-auto">
                <div class="container-fluid px-0">
                    <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between mb-4 gap-3">
                        <div>
                            <h1 class="h3 fw-bold mb-1">Administración de Contenidos</h1>
                            <p class="text-secondary mb-0">Sube recursos multimedia y define evaluaciones para cada curso.</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button id="btn-refrescar-contenidos" class="btn btn-outline-secondary btn-sm">
                                <i class="bi bi-arrow-repeat me-1"></i> Refrescar
                            </button>
                        </div>
                    </div>

                    <div id="admin-contenidos-alert" class="alert d-none" role="alert"></div>

                    <div class="row g-4">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <h2 class="h5 fw-semibold mb-3">Gestor de videos por lección</h2>
                                    <p class="text-secondary small mb-4">
                                        Carga o reemplaza los videos asociados a cada lección. Los cambios se reflejan inmediatamente para los estudiantes.
                                    </p>
                                    <div id="admin-video-feedback" class="alert alert-warning d-none small"></div>
                                    <div id="admin-video-manager" class="accordion" aria-live="polite"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between mb-3 gap-2">
                                        <div>
                                            <h2 class="h5 fw-semibold mb-1">Gestión de evaluaciones</h2>
                                            <p class="text-secondary small mb-0">Define las preguntas y respuestas correctas para los controles y exámenes finales.</p>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button id="btn-nuevo-examen" class="btn btn-primary btn-sm">
                                                <i class="bi bi-plus-lg me-1"></i> Nuevo examen
                                            </button>
                                        </div>
                                    </div>

                                    <div class="row g-3 align-items-end mb-4">
                                        <div class="col-md-6 col-lg-4">
                                            <label for="selector-curso-examen" class="form-label">Curso</label>
                                            <select id="selector-curso-examen" class="form-select">
                                                <option value="">Selecciona un curso</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="selector-examen-existente" class="form-label">Exámenes configurados</label>
                                            <select id="selector-examen-existente" class="form-select" disabled>
                                                <option value="">Selecciona un examen</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div id="examen-alerta" class="alert d-none" role="alert"></div>

                                    <form id="form-examen" class="needs-validation" novalidate>
                                        <input type="hidden" id="examen-id" name="examenId">

                                        <div class="row g-3">
                                            <div class="col-lg-6">
                                                <label for="examen-titulo" class="form-label">Título *</label>
                                                <input type="text" class="form-control" id="examen-titulo" name="titulo" required>
                                            </div>
                                            <div class="col-lg-6">
                                                <label for="examen-tipo" class="form-label">Tipo de evaluación *</label>
                                                <select id="examen-tipo" name="tipo" class="form-select" required>
                                                    <option value="seccion" selected>Control de sección</option>
                                                    <option value="final">Examen final</option>
                                                </select>
                                            </div>
                                            <div class="col-lg-6">
                                                <label for="examen-seccion" class="form-label">Sección asociada</label>
                                                <select id="examen-seccion" name="seccion" class="form-select" disabled>
                                                    <option value="">Selecciona una sección</option>
                                                </select>
                                                <div class="form-text">Solo aplica para controles de sección.</div>
                                            </div>
                                            <div class="col-lg-6">
                                                <label for="examen-tiempo" class="form-label">Tiempo límite (minutos)</label>
                                                <input type="number" min="0" class="form-control" id="examen-tiempo" name="tiempoLimite" placeholder="0 = sin límite">
                                            </div>
                                            <div class="col-lg-6">
                                                <label for="examen-intentos" class="form-label">Intentos permitidos</label>
                                                <input type="number" min="1" value="2" class="form-control" id="examen-intentos" name="intentosPermitidos">
                                            </div>
                                            <div class="col-lg-6">
                                                <label for="examen-aprobacion" class="form-label">% de aprobación</label>
                                                <input type="number" min="0" max="100" value="70" class="form-control" id="examen-aprobacion" name="porcentajeAprobacion">
                                            </div>
                                            <div class="col-12">
                                                <label for="examen-descripcion" class="form-label">Descripción</label>
                                                <textarea class="form-control" id="examen-descripcion" name="descripcion" rows="3"></textarea>
                                            </div>
                                        </div>

                                        <hr class="my-4">

                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h3 class="h6 fw-semibold mb-0">Preguntas del examen</h3>
                                            <button type="button" class="btn btn-outline-primary btn-sm" id="btn-agregar-pregunta">
                                                <i class="bi bi-journal-plus me-1"></i> Añadir pregunta
                                            </button>
                                        </div>

                                        <div id="lista-preguntas" class="mb-4">
                                            <p class="text-secondary small mb-0">Aún no se han agregado preguntas.</p>
                                        </div>

                                        <div id="builder-pregunta" class="card border-0 bg-light-subtle d-none mb-4">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <h4 class="h6 fw-semibold mb-0" id="builder-titulo">Nueva pregunta</h4>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="btn-cerrar-builder">
                                                        Cancelar
                                                    </button>
                                                </div>
                                                <div class="row g-3">
                                                    <div class="col-12">
                                                        <label class="form-label">Enunciado *</label>
                                                        <textarea id="builder-texto" class="form-control" rows="3" required></textarea>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="form-label">Puntuación *</label>
                                                        <input type="number" min="1" value="1" id="builder-puntos" class="form-control">
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="form-label">Tipo *</label>
                                                        <select id="builder-tipo" class="form-select">
                                                            <option value="opcion_multiple" selected>Opción múltiple</option>
                                                            <option value="verdadero_falso">Verdadero / Falso</option>
                                                            <option value="texto">Respuesta abierta</option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div id="builder-opciones-wrapper" class="mt-4">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h5 class="h6 fw-semibold mb-0">Opciones de respuesta</h5>
                                                        <button type="button" class="btn btn-sm btn-outline-primary" id="btn-agregar-opcion">
                                                          <i class="bi bi-plus-lg me-1"></i> Añadir opción
                                                        </button>
                                                    </div>
                                                    <div class="mb-3">
                                                        <div class="input-group input-group-sm mb-2">
                                                            <input type="text" class="form-control" placeholder="Texto de la opción" id="builder-opcion-texto">
                                                            <button class="btn btn-outline-success" type="button" id="btn-guardar-opcion">
                                                                Marcar como correcta
                                                            </button>
                                                            <button class="btn btn-outline-secondary" type="button" id="btn-guardar-opcion-simple">
                                                                Solo agregar
                                                            </button>
                                                        </div>
                                                        <div class="form-text">Utiliza "Marcar como correcta" para registrar la respuesta correcta.</div>
                                                    </div>
                                                    <div id="builder-opciones-lista" class="d-flex flex-wrap gap-2"></div>
                                                </div>

                                                <div class="d-flex gap-2 mt-4">
                                                    <button type="button" class="btn btn-primary btn-sm" id="btn-guardar-pregunta">
                                                        Guardar pregunta
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btn-limpiar-pregunta">
                                                        Limpiar
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-save me-1"></i> Guardar examen
                                            </button>
                                            <button type="button" class="btn btn-outline-danger d-none" id="btn-eliminar-examen">
                                                <i class="bi bi-trash me-1"></i> Eliminar examen
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/include.js"></script>
    <script src="scripts/api.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/notificaciones-api.js"></script>
    <script src="scripts/app.js"></script>
    <script src="scripts/admin-media.js"></script>
    <script src="scripts/admin-contenidos.js"></script>
</body>
</html>

